<!DOCTYPE html>
<html>
<head>
<title>Bad Frontend Code</title>
<style>
    /* Styles remain the same as the previous parent version */
    body {
        font-family: sans-serif;
        padding: 20px;
        background-color: #e0e0e0;
    }
    .browser-window {
        position: relative;
        width: 800px;
        height: 550px;
        border: 1px solid #aaa;
        background-color: #fff;
        margin-bottom: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        border-radius: 8px;
        overflow: hidden;
    }
    .title-bar {
        background-color: #ddd;
        height: 30px;
        display: flex;
        align-items: center;
        padding: 0 10px;
        border-bottom: 1px solid #ccc;
    }
    .buttons { display: flex; gap: 6px; margin-right: 10px; }
    .dot { width: 12px; height: 12px; border-radius: 50%; }
    .red { background-color: #ff5f57; }
    .yellow { background-color: #ffbd2e; }
    .green { background-color: #28c940; }
    .tab-title { font-size: 0.8em; color: #333; background-color: #eee; padding: 4px 10px; border-radius: 4px 4px 0 0; position: relative; top: 1px; }
    #targetIframe { width: 100%; height: calc(100% - 30px); border: none; display: block; }
    #crashOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(50, 50, 50, 0.9); color: #eee; justify-content: center; align-items: center; text-align: center; font-size: 1.5em; display: flex; flex-direction: column; visibility: hidden; opacity: 0; transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; z-index: 10; border-radius: 8px; }
    #crashOverlay.visible { visibility: visible; opacity: 1; }
    .sad-icon { font-size: 3em; margin-bottom: 15px; color: #ffcc00; }
    .controls-main { margin-top: 10px; }
    .controls-main button { padding: 10px 15px; font-size: 1em; cursor: pointer; margin-right: 10px; }
</style>
</head>
<body>

<h1>Things that can happen when your mission critical frontend is written by a backend developer</h1>

<div class="browser-window">
  <div class="title-bar">
      <div class="buttons">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
      </div>
      <span class="tab-title">Admin Dashboard</span>
  </div>
  <iframe id="targetIframe" src="admin_panel.html" title="Admin Dashboard Content"></iframe>

  <div id="crashOverlay">
      <div class="sad-icon">:(</div>
      <div>The 'Admin Dashboard' tab has crashed.</div>
      <div style="font-size: 0.7em; margin-top: 10px;">(This is a simulation)</div>
  </div>
</div>

<div class="controls-main">
   <!-- <button id="simulateCrashBtnParent">Simulate Crash (Parent Button)</button> -->
    <button id="resetBtn">Reset simulation</button>
</div>

<script>
  const overlay = document.getElementById('crashOverlay');
  const simulateBtnParent = document.getElementById('simulateCrashBtnParent'); // Renamed for clarity
  const resetBtn = document.getElementById('resetBtn');
  const iframe = document.getElementById('targetIframe');

  // Function to show the overlay
  function showCrashOverlay() {
      overlay.classList.add('visible');
      console.log('PARENT: Crash overlay activated.');
  }

  // Function to hide the overlay and reset iframe
  function resetSimulation() {
      overlay.classList.remove('visible');
      // Force iframe reload to truly reset its state
      iframe.src = iframe.src; // Reloads admin_panel.html
      console.log('PARENT: Iframe reset and reloaded.');
  }

  // Listener for the PARENT's simulate button
  simulateBtnParent.addEventListener('click', showCrashOverlay);

  // Listener for the reset button
  resetBtn.addEventListener('click', resetSimulation);

  // --- Listener for messages from the iframe ---
  window.addEventListener('message', (event) => {
    // IMPORTANT SECURITY: In production, always check event.origin
    // Example: if (event.origin !== 'http://your-iframe-domain.com') return;
    // For local file:// demo, this check is often skipped, but be aware.

    // Check if the message is the one we expect from the iframe
    if (event.data === 'simulateCrashRequest') {
      console.log('PARENT: Received "simulateCrashRequest" message from iframe.');
      showCrashOverlay(); // Activate the overlay
    }
  });
</script>

</body>
</html>
