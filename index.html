<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Iframe Crash Simulation (Responsive + Murphy's Law)</title>
<style>
    body {
        font-family: sans-serif;
        padding: 20px 10px; /* Added horizontal padding */
        background-color: #e0e0e0;
        margin: 0; /* Ensure no default body margin interferes with centering */
    }
    .browser-window {
        position: relative;
        /* Responsive width: max 800px, otherwise 95% of viewport */
        max-width: 800px;
        width: 95%;
        /* Adjusted height slightly, consider max-height too if needed */
        height: 500px;
        border: 1px solid #aaa;
        background-color: #fff;
        /* Centering the block */
        margin: 20px auto 15px auto; /* Top margin, Auto horizontal margins, Bottom margin */
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        border-radius: 8px;
        overflow: hidden;
    }
    .title-bar {
        background-color: #ddd;
        height: 30px;
        display: flex;
        align-items: center;
        padding: 0 10px;
        border-bottom: 1px solid #ccc;
        flex-shrink: 0; /* Prevent title bar from shrinking if window height is constrained */
    }
    .buttons { display: flex; gap: 6px; margin-right: 10px; }
    .dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; } /* Prevent dots from shrinking */
    .red { background-color: #ff5f57; }
    .yellow { background-color: #ffbd2e; }
    .green { background-color: #28c940; }
    .tab-title {
        font-size: 0.8em;
        color: #333;
        background-color: #eee;
        padding: 4px 10px;
        border-radius: 4px 4px 0 0;
        position: relative;
        top: 1px;
        white-space: nowrap; /* Prevent title wrapping */
        overflow: hidden; /* Hide overflow if needed */
        text-overflow: ellipsis; /* Add ellipsis if title overflows */
    }
    #targetIframe {
        width: 100%;
        /* Calculate height: total height minus title bar height */
        height: calc(100% - 30px);
        border: none;
        display: block;
    }
    #crashOverlay {
        /* Styles remain the same */
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(50, 50, 50, 0.9); color: #eee;
        justify-content: center; align-items: center; text-align: center;
        font-size: 1.5em; display: flex; flex-direction: column;
        visibility: hidden; opacity: 0;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        z-index: 10; border-radius: 8px;
    }
    #crashOverlay.visible { visibility: visible; opacity: 1; }
    .sad-icon { font-size: 3em; margin-bottom: 15px; color: #ffcc00; }

    /* Controls below the browser window */
    .controls-main {
        /* Center the controls container itself */
        max-width: 800px; /* Match browser window max-width */
        width: 95%;
        margin: 0 auto 20px auto; /* Auto horizontal margins, Bottom margin */
        text-align: center; /* Center buttons within the container */
    }
    .controls-main button {
        padding: 10px 15px;
        font-size: 1em;
        cursor: pointer;
        margin: 5px; /* Add spacing between buttons */
    }

    /* Murphy's Law Text Styling */
    #murphyText {
        text-align: center;
        margin: 0 auto 20px auto; /* Center block and add bottom margin */
        max-width: 800px; /* Match browser window max-width */
        width: 90%;
        font-style: italic;
        color: #444; /* Slightly darker */
        /* Initially hidden, matching overlay transition */
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    #murphyText.visible {
        visibility: visible;
        opacity: 1;
    }

    /* Simple media query for very small screens if needed */
    @media (max-width: 400px) {
        .browser-window {
            height: 400px; /* Reduce height slightly more on very small screens */
        }
        #crashOverlay {
             font-size: 1.2em; /* Slightly smaller text in overlay */
        }
        .controls-main button {
             font-size: 0.9em; /* Smaller buttons */
        }
        #murphyText {
             font-size: 0.9em;
        }
    }

</style>
</head>
<body>

<div class="browser-window">
  <div class="title-bar">
      <div class="buttons">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
      </div>
      <span class="tab-title">Admin Dashboard</span>
  </div>
  <iframe id="targetIframe" src="admin_panel.html" title="Admin Dashboard Content"></iframe>

  <div id="crashOverlay">
      <div class="sad-icon">:(</div>
      <div>The 'Admin Dashboard' tab has crashed.</div>
      <div style="font-size: 0.7em; margin-top: 10px;">(This is a simulation)</div>
  </div>
</div>

<div class="controls-main">
    <button id="simulateCrashBtnParent" hidden>Simulate Crash (Parent Button)</button>
    <button id="resetBtn">Reset Iframe</button>
</div>

<p id="murphyText">Murphy's Law: If anything can go wrong, it will.</p>


<script>
  const overlay = document.getElementById('crashOverlay');
  const simulateBtnParent = document.getElementById('simulateCrashBtnParent');
  const resetBtn = document.getElementById('resetBtn');
  const iframe = document.getElementById('targetIframe');
  const murphyText = document.getElementById('murphyText'); // Get the Murphy's Law element

  // Function to show the overlay AND Murphy's Law text
  function showCrashOverlay() {
      overlay.classList.add('visible');
      murphyText.classList.add('visible'); // Show Murphy's Law text
      console.log('PARENT: Crash overlay activated.');
  }

  // Function to hide the overlay AND Murphy's Law text, and reset iframe
  function resetSimulation() {
      overlay.classList.remove('visible');
      murphyText.classList.remove('visible'); // Hide Murphy's Law text
      // Force iframe reload to truly reset its state
      iframe.src = iframe.src; // Reloads admin_panel.html
      console.log('PARENT: Iframe reset and reloaded.');
  }

  // Listener for the PARENT's simulate button
  simulateBtnParent.addEventListener('click', showCrashOverlay);

  // Listener for the reset button
  resetBtn.addEventListener('click', resetSimulation);

  // Listener for messages from the iframe (to trigger the crash simulation)
  window.addEventListener('message', (event) => {
    // SECURITY NOTE: Check event.origin in production!
    // Example: if (event.origin !== 'http://your-iframe-domain.com') return;

    if (event.data === 'simulateCrashRequest') {
      console.log('PARENT: Received "simulateCrashRequest" message from iframe.');
      showCrashOverlay(); // Activate the overlay and Murphy's text
    }
  });
</script>

</body>
</html>
